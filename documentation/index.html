<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>UKFTractography: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>UKFTractography Documentation</h1>  </div>
</div>
<div class="contents">
<h3 class="version">1.0 </h3><p>This module traces fibers in a DWI Volume using the multiple tensor unscented Kalman Filter methology. </p>
<div align="center">
<img src="UKFloop.png" alt="UKFloop.png"/>
<p><strong>System overview illustrating relation between the neural fibers, scanner signals, and the unscented Kalman Filter as it is used to estimate the local model</strong></p></div>
 <dl class="author"><dt><b>Authors:</b></dt><dd>Yogesh Rathi, Stefan Lienhard, Yinpeng Li, Martin Styner, Ipek Oguz, Yundi Shi, Christian Baumgartner</dd></dl>
<h2><a class="anchor" id="Introduction"></a>
Introduction</h2>
<dl class="user"><dt><b></b></dt><dd>The C++ module for Unscented Kalman Filter (UKF) <a class="el" href="classTractography.html" title="This class performs the tractography and saves each step.">Tractography</a> enables the user to easily perform multi-tensor filtered tractography on diffusion weighted MR images. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The model is highly customizable. one-, two-, and three-tensor models are available with, and without free water estimation. In addition, a 'full tensor model' representation is available, where each of the eigenvalues is modeled sperately. The UKF can be run constrained with Quadratic Programming or unconstrained. </dd></dl>
<dl class="user"><dt><b></b></dt><dd>The code can be easily compiled as described below, and can be run either from command line or as Slicer 3 or 4 module.</dd></dl>
<h2><a class="anchor" id="Building"></a>
Building</h2>
<p>In order to build make a new directory outside of the source tree called for example ukf-build.</p>
<p>There are 3 ways to build the project </p>
<ol>
<li>
<b>Standalone:</b> From your build directory run the following commands <div class="fragment"><pre class="fragment">    cmake &lt;path-to-source&gt;/SuperBuild
    make
</pre></div> This will download all resources and build the project for you.<br/>
 Note: cmake &gt;= 2.8.4, git, and svn are required for this  </li>
<li>
<b>Build with Slicer:</b> To build against one of the slicer versions run <ol type="a">
<li>
Slicer 3 <div class="fragment"><pre class="fragment">         cmake -DSlicer3_DIR=&lt;path-to-slicer3&gt;/Slicer3-build &lt;path-to-source&gt;
         make
</pre></div>  </li>
<li>
Slicer 4 <div class="fragment"><pre class="fragment">        cmake -DSlicer_DIR=&lt;path-to-slicer4&gt;/Slicer-build &lt;path-to-source&gt;
        make
</pre></div>  </li>
</ol>
Note: cmake &gt;= 2.6, and an installed version of boost &gt;1.41.1 is required Also, you must have a Slicer build. Only, executables are not enough.  </li>
<li>
<p class="startli"><b>Manual Build:</b> You can take care of all dependancies yourself, the easiest way to do this is using ccmake. Run ccmake from your build directory </p>
<div class="fragment"><pre class="fragment"> ccmake &lt;path-to-source&gt; 
</pre></div><p> Provide the Links to the builds of ITK, Teem, GenerateCLP, and Boost </p>
<div class="fragment"><pre class="fragment"> make 
</pre></div><p> Note: This is only recommended if the above two methods failed for some reason </p>
<p class="endli"></p>
</li>
</ol>
<h2><a class="anchor" id="Running"></a>
Running</h2>
<dl class="user"><dt><b></b></dt><dd><ol>
<li>
<b>As Command Line Module: </b> The executable will be called 'UKFTractography', and can be found in the bin directory of your build folder. <br/>
 In order to see all options run. <div class="fragment"><pre class="fragment">     ./UKFTractography --help 
</pre></div> In the source directory of the project you will find a shell script called 'sample_run.sh' It should give you an idea of what a function call could look like. </li>
<li>
<b>As Slicer 3 or 4 module: </b> Open Slicer and in the settings add the '&lt;path-to-build&gt;/bin' directory. When you restart Slicer the module will be under Diffusion-&gt;<a class="el" href="classTractography.html" title="This class performs the tractography and saves each step.">Tractography</a>. </li>
</ol>
</dd></dl>
<h2><a class="anchor" id="Options"></a>
Options</h2>
<p><b>Input/Output (IO)</b> </p>
<table  border="0" width="100%">
<tr>
<td width="33%">--dwiFile &lt;std::string&gt; </td><td width="67%">Input DWI Image  </td></tr>
<tr>
<td width="33%">--seedsFile &lt;std::string&gt; </td><td width="67%">Seeds for diffusion. If not specified, full brain tractography will be performed, and the algorithm will start from every voxel in the brain mask where the Generalized Anisotropy is bigger than 0.18  </td></tr>
<tr>
<td width="33%">--labels &lt;std::vector&lt;int&gt;&gt; </td><td width="67%">A vector of the ROI labels to be used (default: 1)  </td></tr>
<tr>
<td width="33%">--maskFile &lt;std::string&gt; </td><td width="67%">Mask for diffusion tractography  </td></tr>
<tr>
<td width="33%">--tracts &lt;std::string&gt; </td><td width="67%">Tracts generated, with first tensor output  </td></tr>
<tr>
<td width="33%">--tractsWithSecondTensor &lt;std::string&gt; </td><td width="67%">Tracts generated with second tensor output (if there is one)  </td></tr>
</table>
<p><b>Seeding Options</b> </p>
<table  border="0" width="100%">
<tr>
<td width="33%">--seedsPerVoxel &lt;int&gt; </td><td width="67%">Number of seeds per voxel (default: 1)  </td></tr>
</table>
<p><b>Model Options</b> </p>
<table  border="0" width="100%">
<tr>
<td width="33%">--numTensor &lt;1|2|3&gt; </td><td width="67%">Number of tensors used (default: 2)  </td></tr>
<tr>
<td width="33%">--simpleTensorModel </td><td width="67%">Whether to use the simple tensor model. If unchecked, use the full tensor model  </td></tr>
<tr>
<td width="33%">--freeWater </td><td width="67%">Adds a term for free water difusion to the model. If checked, the 1T simple model is forced.   </td></tr>
</table>
<p><b>Stopping Criteria</b> </p>
<table  border="0" width="100%">
<tr>
<td width="33%">--minFA &lt;double&gt; </td><td width="67%">Abort the tractography when the Fractional Anisotropy is less than this value (default: 0.15)  </td></tr>
<tr>
<td width="33%">--minGA &lt;double&gt; </td><td width="67%">Abort the tractography when the Generalized Anisotropy is less than this value (default: 0.1)  </td></tr>
</table>
<p><b><a class="el" href="structFiber.html" title="Points of a fiber, and scalars corresponding to the points.">Fiber</a> Scalar Fields</b> </p>
<table  border="0">
<tr>
<td width="33%">--recordFA </td><td width="67%">Whether to store FA. Attaches field 'FA', and 'FA2' for 2-tensor case to fiber.   </td></tr>
<tr>
<td width="33%">--recordNMSE </td><td width="67%">Whether to store NMSE. Attaches field 'NMSE' to fiber.   </td></tr>
<tr>
<td width="33%">--recordTrace </td><td width="67%">Whether to store Trace. Attaches field 'Trace', and 'Trace2' for 2-tensor case to fiber.   </td></tr>
<tr>
<td width="33%">--recordFreeWater </td><td width="67%">Whether to store the fraction of free water. Attaches field 'FreeWater' to fiber.   </td></tr>
<tr>
<td width="33%">--recordState </td><td width="67%">Whether to attach the states to the fiber. Will generate field 'state'.   </td></tr>
<tr>
<td width="33%">--recordCovariance </td><td width="67%">Whether to store the covariance. Will generate field 'covariance' in fiber.   </td></tr>
<tr>
<td width="33%">--recordTensors </td><td width="67%">Recording the tensors enables Slicer to color the fiber bundles by FA, orientation, and so on. The fields will be called 'TensorN', where N is the tensor number.   </td></tr>
</table>
<p><b>Advanced Options</b> </p>
<table  border="0">
<tr>
<td width="33%">--numThreads &lt;int&gt; </td><td width="67%">Number of threads used during compuation. Set to the number of cores on your workstation for optimal speed. If left undefined boost will figure out the number of cores, and hence threads, during runtime.  </td></tr>
<tr>
<td width="33%">--normalizedDWIData </td><td width="67%">Whether the DWI input data is already normalized  </td></tr>
<tr>
<td width="33%">--stepLength &lt;double&gt; </td><td width="67%">Step length of tractography, in millimeters. (If not set, defined during runtime)  </td></tr>
<tr>
<td width="33%">--weightsOnTensors &lt;std::vector&lt;double&gt;&gt; </td><td width="67%">Weights on different tensors when using multiple tensors. There must be one weight for each tensor, and the weights must sum up to 1. Defaults to equally weighted.  </td></tr>
<tr>
<td width="33%">--maxHalfFiberLength &lt;double&gt; </td><td width="67%">The max length limit of the half fibers generated during tractography. Here the fiber is "half" because the tractography goes in only one direction from one seed point at a time (default: 10000)  </td></tr>
<tr>
<td width="33%">--seedFALimit &lt;double&gt; </td><td width="67%">Seed points whose FA are below this value are excluded. (If not set, defined during runtime)  </td></tr>
<tr>
<td width="33%">--Qm &lt;double&gt; </td><td width="67%">Process noise for angles/direction. (If not set, defined during runtime)  </td></tr>
<tr>
<td width="33%">--Ql &lt;double&gt; </td><td width="67%">Process noise for eigenvalues. (If not set, defined during runtime)  </td></tr>
<tr>
<td width="33%">--Qw &lt;double&gt; </td><td width="67%">Process noise for free water weights, ignored if no free water estimation. (If not set, defined during runtime)  </td></tr>
<tr>
<td width="33%">--Rs &lt;double&gt; </td><td width="67%">Measurement noise. (If not set, defined during runtime)  </td></tr>
<tr>
<td width="33%">--maxBranchingAngle &lt;double&gt; </td><td width="67%">Maximum branching angle, in degrees. When using multiple tensors, a new branch will be created when the tensors' major directions form an angle between (minBranchingAngle, maxBranchingAngle). Branching is supressed when this maxBranchingAngle is set to 0.0  </td></tr>
<tr>
<td width="33%">--minBranchingAngle &lt;double&gt; </td><td width="67%">Minimum branching angle, in degrees. When using multiple tensors, a new branch will be created when the tensors' major directions form an angle between (minBranchingAngle, maxBranchingAngle)  </td></tr>
</table>
<p><b>Additional Output Options</b> </p>
<table  border="0">
<tr>
<td width="33%">--noTransformPosition </td><td width="67%">Don't transform Points back from ijk-&gt;RAS when writing the output fiber  </td></tr>
<tr>
<td width="33%">--branchesOnly </td><td width="67%">Only output branches, ignore the primary tracts  </td></tr>
<tr>
<td width="33%">--storeGlyphs </td><td width="67%">Store tensors' main directions as two-point lines in a separate file named glyphs_{tracts}. When using multiple tensors, only the major tensors' main directions are stored  </td></tr>
<tr>
<td width="33%">--outputNormalizedDWIData </td><td width="67%">Whether to output the DWI after normalization (i.e. preprocessing)  </td></tr>
</table>
<p><b><a class="el" href="classTractography.html" title="This class performs the tractography and saves each step.">Tractography</a> unrelated options</b> </p>
<table  border="0" width="100%">
<tr>
<td width="33%">--returnparameterfile &lt;std::string&gt; </td><td width="67%">Filename in which to write simple return parameters (int, float, int-vector, etc.) as opposed to bulk return parameters (image, geometry, transform, measurement, table).  </td></tr>
<tr>
<td width="33%">--processinformationaddress &lt;std::string&gt; </td><td width="67%">Address of a structure to store process information (progress, abort, etc.). (default: 0)  </td></tr>
<tr>
<td width="33%">--xml </td><td width="67%">Produce xml description of command line arguments.  </td></tr>
<tr>
<td width="33%">--echo </td><td width="67%">Echo the command line arguments.  </td></tr>
<tr>
<td width="33%">--, --ignore_rest </td><td width="67%">Ignores the rest of the labeled arguments following this flag.  </td></tr>
<tr>
<td width="33%">--version </td><td width="67%">Displays version information and exits.  </td></tr>
<tr>
<td width="33%">-h, --help </td><td width="67%">Displays usage information and exits.  </td></tr>
</table>
<h2><a class="anchor" id="Dependencies"></a>
Dependencies</h2>
<dl class="user"><dt><b>Boost</b></dt><dd>The Boost C++ Libraries are a collection of free libraries that extend the functionality of C++. In this project boost is used for multithreading, and the progress bar. </dd></dl>
<dl class="user"><dt><b>teem</b></dt><dd>Teem is a coordinated group of libraries for representing, processing, and visualising scientific raster data. We use it to read, and process The input data of type NRRD. </dd></dl>
<dl class="user"><dt><b>ITK</b></dt><dd>Insight Segmentation and Registration Toolkit (ITK). ITK is an open-source, cross-platform system that provides developers with an extensive suite of software tools for image analysis. In this application we only use the underlying vnl libraries for most of the linear algebra processing. It replaces functionality that was done with LAPACK before. </dd></dl>
<dl class="user"><dt><b>Slicer Execution Model</b></dt><dd>The Execution Model provides a simple mechanism for incorporating command line programs as Slicer modules. These command line modules are self-describing, emitting an XML description of its command line arguments. Slicer uses this XML description to construct a GUI for the module. We use it to make our application into a Command Line Module that can be run from Slicer, or from a Consolse without being dependand on Slicer. </dd></dl>
<h2><a class="anchor" id="Screenshots"></a>
Screenshots</h2>
<div align="center">
<img src="2TFW_0.png" alt="2TFW_0.png"/>
<p><strong>Tracing fibers through the anterior limb of the internal capsule</strong></p></div>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000005">Todo:</a></b></dt><dd>Doxygen can elegantly be generated by cmake as describe e.g. here <a href="http://www.cmake.org/pipermail/cmake/2006-August/010794.html.">http://www.cmake.org/pipermail/cmake/2006-August/010794.html.</a> </dd></dl>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Fri Mar 16 2012 13:27:37 for UKFTractography by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
